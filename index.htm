<!DOCTYPE html>
<html lang='es'>
<head>
  <meta charset='UTF-8'>
  <title>TangoAsia</title>

<style>
body{
	font-size:16px;
}
a:link,a:visited,a:focus,a:active{
	text-decoration: none;
}
a:hover{
	margin-left:3px; 
}
.stipo{
	border-radius:0px 8px 8px 0px;
	display: inline-block;
	width: 100px;
}
.sCity{
	display: inline-block;
	width: 80px;
}
h3{
	margin: 0px 0px 0px 6px ;
	color: #222;
}
h4{
	margin: 8px 0px 12px 6px;
	color: #666;
}
select{
	width: 120px;
}
#link{
	width:15px;
	position:relative;
	top:3px;
	z-index:0;
}
#cuenta{
	color: #AAA;
}
#fijo{
	background: #fff;
	position: fixed;
	background: #fff;
	position: fixed;
	top: 0px;
	left: 0px;
	width: 100%;
	padding:20px 10px 10px 20px;
	z-index: 999;
	box-shadow: 0px 0px 6px 0px rgba(0, 0, 0, 0.5);
}
#resultados{
	font-family: "Noto Sans Mono", monospace;
 	font-size:12px;
}
</style>
<script src='datosTango.js'></script>
<script>
// datosTango.js
// datosPeople.js

const fsel1='-- area';
const fsel2='-- city';
const fsel3='-- type';
const fsel4='-- dates';
const fsel5='-- view';

function inicio(){
	//console('inicio');
	// crear estructura desde JavaScript
	const body=document.body;
	body.style.fontFamily='Arial,sans-serif';
	body.style.padding='20px';
	// tÃ­tulo
	const fijo=document.createElement('div');
	fijo.id='fijo';
	body.appendChild(fijo);
	const tt1=document.createElement('h3');
	tt1.innerHTML=titulo1+'&nbsp;by KoKo Tango';
	const tt2=document.createElement('h4');
	tt2.innerHTML=titulo2;
	fijo.appendChild(tt1);
	fijo.appendChild(tt2);
	// selectores
	fijo.appendChild(crearSelcountry());
	fijo.appendChild(crearSel2());	
	crearSelCity(); 
	fijo.appendChild(crearSel3());
	crearSelType();	
	if (app=='tango'){
		fijo.appendChild(crearSel4());
		crearSelDates();
		fijo.appendChild(crearSel5());
	}
	// listado
	const results=document.createElement('ul');
	results.id='resultados';
	if (app=='tango'){
		results.style.marginTop='110px';
	}else{
		results.style.marginTop='80px';
	}
	results.style.marginLeft='-32px'; 
	body.appendChild(results);
	// visualizar
	renderGo();
	//console('end main');
}

function crearSel5(){
	// Selector 5 , ver por fecha
	let select=document.createElement('select');
	select.id='selector5';
	select.style.fontSize='16px';
	select.style.marginLeft='10px';
	select.addEventListener('change',change5);

	const lista=[fsel5,'annual','countries'];
	lista.forEach(x => {
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});
	
	return select;
}

function crearSel4(){
	// Selector 4 , para tango fechas
	let select=document.createElement('select');
	select.id='selector4';
	select.style.fontSize='16px';
	select.style.marginLeft='10px';
	select.addEventListener('change',change4);	
	return select;
}

function crearSel3(){
	let select=document.createElement('select');
	select.id='selector3';
	select.style.fontSize='16px';
	select.style.marginLeft='10px';
	select.addEventListener('change',change3);
	return select;	
}

function crearSel2(){
	// Selector city
	let select=document.createElement('select');
	select.id='selector2';
	select.style.fontSize='16px';
	select.style.marginLeft='10px';
	select.addEventListener('change',change2);	
	return select;
}

function createOpt(s,v,t){
	  const opt=document.createElement('option');
	  opt.value=v;
	  opt.textContent=t;
	  s.appendChild(opt);
}

function crearSelType(){
	
	let select=document.getElementById('selector3'); 
	select.innerHTML='';

	let optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel3;
	select.appendChild(optionDefault);

/*
	let optionAll=document.createElement('option');
	optionAll.value='all';
	optionAll.textContent='all*';
	select.appendChild(optionAll);
*/

	// grupos
	
	//nota: dejaria de funcionar el selector de fechas dinamico
	if (app=='tango'){
	createOpt(select,'event marathon,event festival,event party','event');
	//createOpt(select,'listevents,event,festival,marathon,address,listmilongas,milonga,spot,party','dance*');
	//createOpt(select,'address,listmilongas,milonga,spot,party','milonga*');
	//createOpt(select,'artist,organizer,writer','people*');		
	}else{
		//createOpt(select,'tanguera,tanguero','dance*');	
	}
	let lista=damecol2();
	lista.forEach(x => {
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});
}

function crearSelcountry(){

	// Selector country
	let select=document.createElement('select');
	select.id='selector1';
	select.style.fontSize='16px';
	select.style.marginLeft='10px';

	let optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel1;
	select.appendChild(optionDefault);

/*
	let optionAll=document.createElement('option');
	optionAll.value='all';
	optionAll.textContent='all*';
	select.appendChild(optionAll);
*/

	damecol(0).forEach(x => {
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});

	select.addEventListener('change',change1);
	return select;

}

function crearSelCity(){
	// para un pais dado 
	// '' todas las ciudades 

	let pais=document.getElementById('selector1').value;
	let select=document.getElementById('selector2'); 
	select.innerHTML='';

	var optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel2;
	select.appendChild(optionDefault);
/*
	var optionAll=document.createElement('option');
	optionAll.value='all';
	optionAll.textContent='all*';
	select.appendChild(optionAll);	
*/
	let lista='';
	if (pais==''){
		lista=damecol(1);
	}else{
		lista=damecol1(1,0,pais);
	}
	//console('sel2',pais,lista);

	lista.forEach(x => {
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});
}

function crearSelDates(){

	let select=document.getElementById('selector4'); 
	select.innerHTML='';

	var optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel4;
	select.appendChild(optionDefault);

/*
	var optionAll=document.createElement('option');
	optionAll.value='all';
	optionAll.textContent='all*';
	select.appendChild(optionAll);	
*/

	let lista=damecol3(); 

	lista.forEach(x => {
		const opt=document.createElement('option');
		opt.value=x;
		opt.textContent=x;
		select.appendChild(opt);
	});
}

function sortSet(s1){
	const a=[...s1];
	a.sort();
	const s2=new Set(a);
	return s2;
}

function damecol3(){
	// dame los valores sin repetir de col con col1=v1 y col2=v2

	let col=4; // columna salida
	let v1=document.getElementById('selector1').value; 
	let v2=document.getElementById('selector2').value; 	
	let s3=document.getElementById('selector3'); // event *
	let v3=s3.options[s3.selectedIndex].innerText;  
	let col1=0;
	let col2=1;
	let col3=2;
	
	const set=new Set();
	for (i=0;i<datos.length;i++){
		//console('colcol:',i,datos[i][col1],v1,datos[i][col2],v2);
		if(v1=='all' || v1=='' || datos[i][col1]==v1){
			if(v2=='all' || v2=='' || datos[i][col2]==v2){
				if(v3==fsel3 || v3=='' ||  datos[i][col3].indexOf(v3)!=-1 ){	
					let x=datos[i][col];
		//console('CSD:',datos[i][col3],'-',v3);					
					if (x==''){continue}
						
					if (x[0]=='.'){ // no mes
						z=x.substr(1,x.length-1); 
					}else{ // mes
						//let y=(x.split(')')[1]).split(' ')[0];
						let y=x.split(' ')[0];
						z=y;					
					}
					if (z==''){continue}
					set.add(z); 
				}
			}
		}
	}
	//console('col3 ',set);
	return sortSet(set);
}

function damecol2(){
	// dame los valores sin repetir de col con col1=v1 y col2=v2
	
	let col=2; // columna salida tipo
	let v1=document.getElementById('selector1').value; 
	let v2=document.getElementById('selector2').value; 	
	let col1=0;
	let col2=1;
	
	const set=new Set();
	for (i=0;i<datos.length;i++){
		//console('colcol:',i,datos[i][col1],v1,datos[i][col2],v2);
		if(v1=='all' || v1=='' || datos[i][col1]==v1){
			if(v2=='all' || v2=='' || datos[i][col2]==v2){
				let valor=datos[i][col];
				if (valor!=''){
					set.add(valor);          
				}
			}
		}
	}
	//console('col2 ',set);
	return sortSet(set);
}

function damecol1(col,col1,v1){
	// dame los valores sin repetir de col con col1=v1
	const set=new Set();
	for (i=0;i<datos.length;i++){
		//console('colcol:',i,v1);
		if(v1=='all' || datos[i][col1]==v1){
			let valor=datos[i][col];
			if (valor!=''){
				set.add(valor);          
			}
		}
	}
	//console(set);
	return sortSet(set);
}


function damecol(col1){
  const set=new Set();
  for (i=0;i<datos.length;i++){
  	//console(datos[i]);   
 	let linea=datos[i][col1];
      if (linea!=''){
		let primer=linea.split(' ');
		let valor=primer[0];    
		set.add(valor);          
      }
  }
	return sortSet(set);
}

function damelista(pais){
// para un pais dado,lista de datos coko array de objetos
  res=[];
  for (i=0;i<datos.length;i++){
    if (pais==datos[i][0]){
		//let fecha=datos[i][4].split(' ')[0];
		//let fecha=linea[0];
		let o={
		ciudad:datos[i][1],
		tipo:datos[i][2],
		nombre:datos[i][3],
		fechas:datos[i][4],
		url:datos[i][5],
      }
      res.push(o);
    }
  }
  return res.sort();
}

function change1(e){
	//let v=document.getElementById('selector1').value;
	crearSelCity(); 
	crearSelType();
	if (app!='people'){crearSelDates()}
	renderGo();
}

function change2(e){
	crearSelType();
	if (app!='people'){crearSelDates()}
	renderGo();
}

function change3(e){
	if (app!='people'){crearSelDates()}
	renderGo();
}

function change4(e){
	renderGo();
}

function change5(e){
	renderGo();
}

function renderGo(){
	const s1=document.getElementById('selector1').value; 
	const s2=document.getElementById('selector2').value;
	const s3=document.getElementById('selector3').value;
	let s4='';if (app!='people'){s4=document.getElementById('selector4').value;}
	const s5=document.getElementById('selector5').value;
	render(s1,s2,s3,s4,s5);
}

function renderCountries(s1,s2,s3,s4){

	////console('render',s1,s2);
	const results=document.getElementById('resultados');  
	results.innerHTML='';
	let contadorL1=0;

	const paises=(s1==''||s1==='all') ? damecol(0) : [s1];
	for (const pais of paises) {
		const entradas=damelista(pais);
		if (entradas.length==0){continue}

		// TÃ­tulo del paÃ­s
		var header=document.createElement('li');
		header.style.listStyleType='none'; // change lista    
		header.innerHTML=pais;
		header.style.fontWeight='bold';
		results.appendChild(header);

		let a3=s3.split(','); // incluye listas de tipos
		var contadorL2=0;
		//console('entradas:',entradas);
		for (const item of entradas) {    
			// filtro dates
			if (
			      s4!='' &&
			      s4!='all' &&
			      (item.fechas.indexOf(s4)==-1) 
			){continue}   

			// filtro type
			if (
			      s3!='' &&
			      s3!='all' &&
			      (a3.indexOf(item.tipo)==-1)
			      //s3!=item.tipo
			){continue}    

			// filtro ciudad
			if (
			      s2!='' &&
			      s2!='all' &&
			      s2!=item.ciudad
			){continue}

			contadorL2+=1; // linea de nivel2
			contadorL1+=1;
			// ciudad nivel2 
			const li=document.createElement('li');
			li.style.listStyleType='circle'; // change lista    
			li.style.marginLeft='20px';

			// Mostrar texto plano y enlace separado
			const span=document.createElement('span');
			span1='';
			if (item.tipo!=''){
				span1='<span class="stipo" style="background-color:'+colorTipo.get(item.tipo)+
				'">&nbsp;'+item.tipo+'&nbsp;</span>';
			}
			span2='';
			if (item.ciudad!=''){
				span2='<span class="sCity">'+item.ciudad+'&nbsp;</span>';
			}			
			
			

			
			
			
			item.texto=span2+'&nbsp;:&nbsp;'+span1.replace('event','')+
			'&nbsp;:&nbsp;'+item.nombre+'&nbsp;:&nbsp;'+item.fechas+'&nbsp;:&nbsp;';
			span.innerHTML=item.texto;

			li.appendChild(span);

			if (item.url) {
				const spot=document.createTextNode(' ');
				li.appendChild(spot);

				const link=document.createElement('a');
				link.href=item.url;
				  link.innerHTML='<img id="link" src="a1.png">';//icono
				//link.innerHTML='&#128640;';//cohete
				link.target='_blank';
				li.appendChild(link);
			}
			resultados.appendChild(li);
		}
		header.innerHTML+='<span id="cuenta">&nbsp;('+contadorL2+')</span>';
		if (contadorL2==0){
			// esta vacio, borrar la linea
			header.parentNode.removeChild(header);
		}
	}
  
	return contadorL1;
}

let meses=['JAN','FEB','MAR','APR','MAY','JUN','JUL','AGO','SEP','OCT','NOV','DEC'];
function renderannual(s1,s2,s3,s4){

	////console('render',s1,s2);
	const results=document.getElementById('resultados');  
	results.innerHTML='Approximate dates check at the event ð<br/><br/>';

	let contadorL1=0;
	// listado completo
	// para un pais dado,lista de datos coko array de objetos
	  entradas=[];
	  for (i=0;i<datos.length;i++){
		let fechas=datos[i][4];
		if (fechas=='' || fechas[0]=='.'){continue}
		//let fecha=datos[i][4].split(' ')[0];
		//let fecha=linea[0];
		let o={
			pais:datos[i][0],
			ciudad:datos[i][1],
			tipo:datos[i][2],
			nombre:datos[i][3],
			fechas:datos[i][4],
			url:datos[i][5],
		}
		//console('fechas:',o.fechas);
		const actual=new Date();
		let y1=actual.getFullYear();
		const year=o.fechas.split('.')[1];
		const mes=parseInt(o.fechas.substr(1,2))-1;
		const dia=o.fechas.split(' ')[1].split('-')[0];
		// poner aÃ±o a los eventos y calcular si paso la fecha completa o no (11)NOV 22-25.2024
		const f2=new  Date(year,mes,dia);		
		if (f2<actual){y1++} // ya es el aÃ±o que viene
		f3=new Date(y1,mes,dia); // cuando se supone que es el evento
		o.ofecha=f3;
		o.pfecha=f3.getFullYear()+'-'+meses[f3.getMonth()]+'-'+dia.toString().padStart(2, '0');
		//console(f2,mes,dia,o.ofecha);
		entradas.push(o);
	  }
	  //entradas.sort(); // ordenar por fechas
	entradas.sort(function(a, b){return a.ofecha-b.ofecha})	  
	  
/*
	const paises=(s1==''||s1==='all') ? damecol(0) : [s1];
	for (const pais of paises) {
		const entradas=damelista(pais);
		if (entradas.length==0){continue}

		// TÃ­tulo del paÃ­s
		var header=document.createElement('li');
		header.style.listStyleType='none'; // change lista    
		header.innerHTML=pais;
		header.style.fontWeight='bold';
		results.appendChild(header);

		
		var contadorL2=0;
		//console('entradas:',entradas);
	*/	
	let a3=s3.split(','); // incluye listas de tipos
	for (const item of entradas) {    
		// filtro dates
		if (
		      s4!='' &&
		      s4!='all' &&
		      (item.fechas.indexOf(s4)==-1) 
		){continue}   

		// filtro type
		if (
		      s3!='' &&
		      s3!='all' &&
		      (a3.indexOf(item.tipo)==-1)
		      //s3!=item.tipo
		){continue}    

		// filtro ciudad
		if (
		      s2!='' &&
		      s2!='all' &&
		      s2!=item.ciudad
		){continue}
		
		// filtro pais
		if (
		      s1!='' &&
		      s1!='all' &&
		      s1!=item.pais
		){continue}		

		//contadorL2+=1; // linea de nivel2
		contadorL1+=1;
		// ciudad nivel2 
		const li=document.createElement('li');
		li.style.listStyleType='circle'; // change lista    
		li.style.marginLeft='20px';

		// Mostrar texto plano y enlace separado
		const span=document.createElement('span');
		span1='';
		if (item.tipo!=''){
			span1='<span class="stipo" style="background-color:'+colorTipo.get(item.tipo)+
			'">&nbsp;'+item.tipo+'&nbsp;</span>';
		}
		//console('span1',span1);
		item.texto=item.pfecha+'&nbsp;'+span1.replace('event','')+'&nbsp;'+item.nombre+
		'&nbsp;:&nbsp;'+item.ciudad+'&nbsp;:&nbsp;'+item.pais+'&nbsp;:&nbsp;';
		span.innerHTML=item.texto;
		li.appendChild(span);

		if (item.url) {
			const spot=document.createTextNode(' ');
			li.appendChild(spot);

			const link=document.createElement('a');
			link.href=item.url;
			  link.innerHTML='<img id="link" src="a1.png">';//icono
			//link.innerHTML='&#128640;';//cohete
			link.target='_blank';
			li.appendChild(link);
		}
		resultados.appendChild(li);
	
		
		/*
		header.innerHTML+='<span id="cuenta">&nbsp;('+contadorL2+')</span>';
		if (contadorL2==0){
			// esta vacio, borrar la linea
			header.parentNode.removeChild(header);
		}
		*/
		
	}
  
	return contadorL1;
}



function render(s1,s2,s3,s4,s5){

	if (s5!='annual'){
		var contadorL1=renderCountries(s1,s2,s3,s4);
	}else{
		var contadorL1=renderannual(s1,s2,s3,s4);
	}

	const sumario=document.createElement('div');
	sumario.innerHTML='<br/>&#128202;<span><i>'+'show</i> ('+contadorL1+')</span>';    
	resultados.appendChild(sumario); 
    
}
//console('end main');
window.onload=inicio;

</script>
</head>
<body>
</body>
</html>
