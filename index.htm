<!DOCTYPE html>
<html lang='es'>
<head>
  <meta charset='UTF-8'>
  <title>OTLA</title>

<style>
  body{
    font-suze:16px;
  }
a:link,a:visited,a:focus,a:active{
	text-decoration: none;
    filter:blur(1px);   
}
a:hover{
  margin-left:6px; 
    filter:blur(0px); 
}
  h4{
    margin-bottom: 0px;
  }
  h3{
    margin-top: 0px;    
  }
  select{
    width: 120px;
  }
</style>

<script>

/*
TODO
https://onlytangos.github.io/OTLA/ta5.htm
-subir a github,dominio
-completar enlaces
-completar fechas o regular
-cuarto selector meses/regular
-repasar cambiar milonga por space
-people:seguir listado de personas por ciudades (que no esten en la pagina web)
-enlazar a beto tablas , list de beto enlace
-selectores ordenados alfabeticamente (all @ primero)
-colores cercanos mismo grupo de categorias buen contraste o un solo color por grupo
-add ? regular,meses: cuando tengamos muchos eventos
*/

/*
tipo:
-schedule events: fechas y eventos
-schedule milongas: fechas y milongas
-address milonga: lista de las milongas con la direccion sin fechas
-festival name: mas de dos dias con artistas
-marathon name: sin artistas, mas de dos dias
-encuentro name: no mas  de 9 horas al dia sin artistas mas de dos dias
-milonga name: una milonga en concreto
-space name: un lugar para milonga
-party: only one special day for a milonga 1 or 2 dias
-organizer
-writer
-artist
*/

/*mapa colores por tipo*/
const colorTipo=new Map();
// scheduler
colorTipo.set('schedule','#fad984');
colorTipo.set('address','#ffd469');
colorTipo.set('milonga','#adf5d7');
colorTipo.set('space','#adf5d7');
// eventos
colorTipo.set('party','##acccfc');
colorTipo.set('festival','#a1c6ff');
colorTipo.set('encuentro','#7db1ff');
colorTipo.set('marathon','#7db1ff');
// people
colorTipo.set('dj','#db94ff');
colorTipo.set('artist','#e4adff');
colorTipo.set('organizer','#ebc4ff');
colorTipo.set('writer','#F9EE90');

const datos=[
//['China','Hong Kong','festival','cami & eze','','https://www.enjoytango.com/app/show.php?aid=1813'],
//['South Korea','Busan','milonga','flores - el bulin','','https://www.facebook.com/groups/1604439449851502'],
//['Korea','Busan','event','Busan Tango Weekend “El Mar” - Chanbee Bokchan Park','AUG 28-SEP 1',''],
//['South Korea','Seoul','schedule','','','https://www.facebook.com/photo/?fbid=10225455760834686&set=a.3346895424941'],
['Asia','@all','schedule','events','','https://www.facebook.com/photo/?fbid=10233487171534934&set=pcb.1070085518655066'],
['China','@all','schedule','events','','https://www.enjoytango.com/app/list.php?tid=2'],
['China','@all','schedule','milongas','regular','https://www.enjoytango.com/app/list.php?tid=1'],
['China','Beijing','address','milonga','regular','https://mp.weixin.qq.com/s/0tfkvbCKHPF4PDimWNmUgA?poc_token=HLce5Gij6-5hh6PLEdX3IEyAjBQkK_6UVK5hpuw9'],
['China','Beijing','event','Beijing Tango Marathon “Ideal” - Shen Alec & Frank Jin & Robin Liu','SEP 19-21',''],
['China','Hangzhou','event','Hangzhou Tango Festival - Emily & Mauro Mauceri','SEP 12-14',''],
['China','Hangzhou','event','Qian Tang JinSha Tango Live Concert & Festival - Lily & Randy','NOV 7-9',''],
['China','Hangzhou','event','Tango Blast - Aeon','AUG 21-25',''],
['China','Hong Kong','encuentro','festivalito de tango','','https://www.festivalitodetangoenhk.com/'],
['China','Hong Kong','event','Hong Kong Tango Marathon - Daisy Tsang','NOV 14-16',''],
['China','Qingdao','event','Tango Caravan - Liu Zheng','OCT 24-26',''],
['China','Qingdao','festival','tango caravan','','https://www.enjoytango.com/app/show.php?aid=1778'],
['China','Shanghai','event','Shanghai Tango Marathon - Perni Peng & Sergiy Podbolotnyy','NOV 20-23',''],
['China','Shanghai','festival','Shanghai International Tango Festival','','https://www.facebook.com/Shanghaitangofest/'],
['China','Shanghai','marathon','','','https://tangomarathonshanghai.com/'],
['China','Shanghai','milonga','Te Amo Tango Lounge','','https://www.facebook.com/pages/Te%20Amo%20Tango%20Lounge/1073822006087515/'],
['China','Shanghai','organizer','Kai Wang','-','https://www.facebook.com/kaiwang215'],
['China','Xian','event','Xian Tango Festival - Jezebel Dang','OCT 23-26',''],
['China','Xian','festival','tango festival','','https://mp.weixin.qq.com/s/qCTx9sQdv4bkGptTXcl94w'],
['India','Goa','event','Goa International Tango Festival - Shashank Duggal','NOV 14-16',''],
['Indonesia','','','',''],
['Japan','Tokyo','','',null],
['Korea','Chuncheon','event','ChunCheon Tango Marathon - John','OCT 9-12',''],
['Korea','Jeju','event','Jeju Summ Milonga - Kim Seong Gong & Augusto Kim','AUG 22-24',''],
['Korea','Shenyang','event','Shenyang Summer Ice & Snow Tango Weekend - CoCo Feng','AUG 15-17',''],
['Korea','Suncheon','event','Big Milonga “Estrellas” - BongBong & 나미애','SEP 20-21',''],
['Malaysia','','','',''],
['Philippines','','','',''],
['Singapore','Singapore','marathon','tm','','https://www.facebook.com/groups/1595489810766319/?action_source=group_mall_recommendation_affordance'],
['South Korea','@all','schedule','milongas (old)','','https://sites.google.com/view/tangomilongaincorea/where-are-you-now?authuser=0'],
['South Korea','Busan','address','milongas','regular','https://www.facebook.com/photo/?fbid=10231129175306502&set=gm.919471050383181&idorvanity=466828892314068'],
['South Korea','Busan','marathon','Tango WK El Mar - Chanbee Bokchan Park','AUG 28-SEP 1','https://www.facebook.com/groups/1447122242510285'],
['South Korea','Busan','schedule','milongas','regular','https://www.facebook.com/photo/?fbid=10211432120996912&set=pcb.10161231380052488'],
['South Korea','Changwon','milonga','Marine Milonga','','https://www.facebook.com/groups/515183163127903/?ref=share&mibextid=NSMWBT'],
['South Korea','Changwon','organizer','Bonghan Choi - Querencia','-','https://www.facebook.com/bonghan.choi.2025'],
['South Korea','Changwon','party','Querencia 6th Anniversary Party - Changwon Tango','','https://www.facebook.com/story.php?story_fbid=31711799575130399&id=100001813073693&rdid=MAcWSJR603tg6EPj#'],
['South Korea','Changwon-si','milonga',"Papa's 6th",'','https://www.facebook.com/bonghan.choi.2025'],
['South Korea','Chuncheon','','',null],
['South Korea','Daegu','marathon','Daegu Tango Marathon','NOV','https://www.facebook.com/doya.doya.710'],
['South Korea','Daegu','milonga','Doya Doya','','https://www.facebook.com/groups/156014731398037'],
['South Korea','Daejeon','milonga','Azucar','','https://www.facebook.com/milonga.azucar'],
['South Korea','Daejeon','milonga','La Boom','','https://m.cafe.daum.net/djtango/UxYT/755?svc=cafeapp'],
['South Korea','Daejeon','milonga','La Vista','','https://cafe.daum.net/Milonga-Tarde'],
['South Korea','Daejeon','organizer','JIL Milonga','-','https://www.facebook.com/groups/1372855000218884/?ref=share&mibextid=NSMWBT'],
['South Korea','Gyeongju','','',null],
['South Korea','Jeju','marathon','Jeju Summ Milonga','','https://www.jejusummmilonga.com/'],
['South Korea','Pohang','','',null],
['South Korea','Seoul','artist','Eva Youn Christina','','https://www.facebook.com/evayoun'],
['South Korea','Seoul','artist','Misun Kang','','https://www.facebook.com/msddr'],
['South Korea','Seoul','dj','Alex Jonghwa Lee','','https://www.facebook.com/alex.jonghwa.tangodj/'],
['South Korea','Seoul','milonga','Jin - Tango Club Ocho','','https://www.facebook.com/groups/1372855000218884/?ref=share&mibextid=NSMWBT'],
['South Korea','Seoul','milonga','Pista Tango','','https://www.facebook.com/jiyu.banny'],
['South Korea','Seoul','organizer','Aran Sunmi Kang - En Paz','-','https://www.facebook.com/aran.sunmikang/photos'],
['South Korea','Seoul','organizer','Hyun Jung Kim - Luminoso','-','https://www.facebook.com/luminoso.trees'],
['South Korea','Seoul','organizer','IF Kim - IF milonga','-','https://www.facebook.com/johwan.kim.77?rdid=kp3ysBHQtgGwpCC6&share_url=https%3A%2F%2Fwww.facebook.com%2Fshare%2F1BccbedJ3G%2F#'],
['South Korea','Seoul','organizer','Kogsan Kyuho Kim - tangolife','-','https://www.facebook.com/kogsan.kyuho.kim'],
['South Korea','Seoul','schedule','milongas','regular','https://www.facebook.com/photo/?fbid=10233871235096283&set=pcb.1095988249398126'],
['South Korea','Seoul','space','Andante','-','https://www.facebook.com/tango.andante'],
['South Korea','Seoul','space','En Paz','-','https://www.facebook.com/groups/1139011689765653'],
['South Korea','Seoul','writer','Beto Kim','-','https://www.facebook.com/byeoungjun.kim.9'],
['South Korea','Suncheon','marathon','Tango Chang','','https://www.facebook.com/groups/156014731398037'],
['Taiwan','@all','schedule','','-','https://milonga.tw/'],
['Taiwan','Taipei','event','Taipei Tango Festival - Liu Hsin-Yueh','SEP 18-21',''],
['Taiwan','Taipei','event','Taiwan Tango Marathon - Yutan Lin & Lin Yushsun','DEC 26-28',''],
['Taiwan','Taipei','event','Taiwan Tango Weekend (TTW) - Grace Liman Chan, Sheen Chan','OCT 24-26',''],
['Taiwan','Taipei','festival','Taipei Tango Festival','','https://www.taipeitangofestival.com/'],
['Taiwan','Taipei','marathon','Taiwan Tango Marathon','','https://twtangomarathon.com/'],
['Taiwan','Taipei','milonga','Tango Association','','https://tangotaiwan.weebly.com/'],
['Vietnam','Hanoi','encuentro','La Luna Tango Encuentro - Nguyen Phuong Ngoc','OCT 30-NOV 2','https://www.laluna-encuentro.com/'],
];

const fsel1='-- area';
const fsel2='-- city';
const fsel3='-- type';

function inicio(){
console.log('inicio');
// Crear estructura desde JavaScript
const body=document.body;
body.style.fontFamily='Arial,sans-serif';
body.style.padding='20px';

// Título
const h1=document.createElement('h3');
h1.innerHTML=
`Only Tango Links Asia (OTLA) v5 <br/> 
아시아 유일의 탱고 링크 &#128518; 亚洲唯一的探戈舞场 &#128518; アジア唯一のタンゴリンク<br/>`;
body.appendChild(h1);

// selectores
crearSelcountry(); // sel1 paises
crearSel2(); // contenedor
crearSelCity(''); // pais all => '' vacio todas ; all todas las ciudades del pais
crearSelType();

// listado
const results=document.createElement('ul');
results.id='resultados';
results.style.marginTop='20px';
body.appendChild(results);

render();
console.log('end main');

}

function sortSet(s1){
	const a=[...s1];
	a.sort();
	const s2=new Set(a);
	return s2;
}

function crearSelType(){
	// Selector tipo
	var select=document.createElement('select');
	select.id='selector3';
	select.style.fontSize='16px';
	select.style.marginLeft='10px';

	var optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel3;
	select.appendChild(optionDefault);

	var optionAll=document.createElement('option');
	optionAll.value='all';
	optionAll.textContent='all';
	select.appendChild(optionAll);

	damecol(2).forEach(x => {
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});

	select.addEventListener('change',change3);
	document.body.appendChild(select);
	
}

function crearSel2(){
	// Selector city
	var select=document.createElement('select');
	select.id='selector2';
	select.style.fontSize='16px';
	select.style.marginLeft='10px';
	document.body.appendChild(select);	
	select.addEventListener('change',change2);	
	
}

function crearSelCity(pais){
	// para un pais dado 
	// '' todas las ciudades 

	const select=document.getElementById('selector2'); 
	select.innerHTML='';

	var optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel2;
	select.appendChild(optionDefault);

	var optionAll=document.createElement('option');
	optionAll.value='all';
	optionAll.textContent='all';
	
	select.appendChild(optionAll);	

	let lista='';
	if (pais==''){
		lista=damecol(1);
	}else{
		lista=damecolcol(1,0,pais);
	}
	console.log('sel2',pais,lista);

	lista.forEach(x => {
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});

}

function crearSelcountry(){

	// Selector country
	var select=document.createElement('select');
	select.id='selector1';
	select.style.fontSize='16px';
	select.style.marginLeft='10px';

	var optionDefault=document.createElement('option');
	optionDefault.value='';
	optionDefault.textContent=fsel1;
	select.appendChild(optionDefault);

	var optionAll=document.createElement('option');
	optionAll.value='all';
	optionAll.textContent='all';
	select.appendChild(optionAll);

	damecol(0).forEach(x => {
	  const opt=document.createElement('option');
	  opt.value=x;
	  opt.textContent=x;
	  select.appendChild(opt);
	});

	select.addEventListener('change',change1);
	document.body.appendChild(select);
}fsel1

function damecolcol(col2,col1,v){
	// dame una col2 con otro valor en col1
	const set=new Set();
	for (i=0;i<datos.length;i++){
	console.log('colcol:',i,v);
		if(v=='all' || datos[i][col1]==v){
			let valor=datos[i][col2];
      if (valor!=''){
        set.add(valor);          
      }
		}
	}
	console.log(set);
	return sortSet(set);
}


function damecol(col1){
  const set=new Set();
  for (i=0;i<datos.length;i++){
      let valor=datos[i][col1];
      if (valor!=''){
        set.add(valor);          
      }
  }
  console.log(set);
  return sortSet(set);
}
function damelista(pais){
// para un pais dado,lista de datos coko array de objetos
  res=[];
  for (i=0;i<datos.length;i++){
    if (pais==datos[i][0]){
      let o={
        ciudad:datos[i][1],
        tipo:datos[i][2],
        nombre:datos[i][3],
        url:datos[i][5]
      }
      res.push(o);
    }
  }
  return res;
}

function change1(e){
	// recargar las ciudades para ese pais,en el selector anterior
	let v=document.getElementById('selector1').value;
	crearSelCity(v); 
	render();
}
function change2(e){
	//let v=document.getElementById('selector1').value;
	render();
}
function change3(e){
	render();
}

function render() {

  const s1=document.getElementById('selector1').value; 
  const s2=document.getElementById('selector2').value;
  const s3=document.getElementById('selector3').value;

  console.log('render',s1,s2);
  const results=document.getElementById('resultados');  
  results.innerHTML='';

  //if (!s1) return;
  // todos los paises o el que entro
  const paises=(s1==''||s1==='all') ? damecol(0) : [s1];

  for (const pais of paises) {
    const entradas=damelista(pais);
    //console.log('entradas:',s2,entradas);

    if (entradas.length === 0) continue;

    // Título del país
    const header=document.createElement('li');
    header.textContent=pais;
    header.style.fontWeight='bold';
    results.appendChild(header);

    for (const item of entradas) {

      // sobre el listado de paises
      // usar el selector de ciudad
      console.log('item:',s2,item.ciudad);
      if (
      s3!='' &&
      s3!='all' &&
      s3!=item.tipo
      ){continue}    
      if (
      s2!='' &&
      s2!='all' &&
      s2!=item.ciudad
      ){continue}



      const li=document.createElement('li');
      li.style.marginLeft='20px';

      // Mostrar texto plano y enlace separado
      const span=document.createElement('span');
      span1='';
      if (item.tipo!=''){
	span1='<span style="background-color:'+colorTipo.get(item.tipo)+'">&nbsp;'+item.tipo+'&nbsp;</span>';
      }
      item.texto=item.ciudad+' : '+span1+' : '+item.nombre+' : ';
      span.innerHTML=item.texto;

      li.appendChild(span);

      if (item.url) {
        const space=document.createTextNode(' ');
        li.appendChild(space);

        const link=document.createElement('a');
        link.href=item.url;
        link.innerHTML='&#128640;';
        link.target='_blank';
        li.appendChild(link);
      }

      results.appendChild(li);
    }
  }
}

console.log('end main');
window.onload=inicio;

</script>
</head>
<body>
</body>
</html>
